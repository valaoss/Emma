<html lang="en">
<%- include("./partials/head.ejs") %>

<body>
<%- include("./partials/nav.ejs") %>

<main class="page page-details">
  <section class="details-card">
    <header class="details-header">
      <p class="details-label">Blog post</p>
      <h1><%= blog.title %></h1>
    </header>

    <article class="details-body">
      <p><%= blog.body %></p>
    </article>

    <footer class="details-footer">
      <a href="/blogs" class="btn btn-ghost">‚Üê Back to all blogs</a>
      <button
        type="button"
        class="btn btn-danger delete"
        data-doc="<%= blog._id %>"
      >
        Delete blog
      </button>
    </footer>
  </section>
</main>

<%- include("./partials/footer.ejs") %>

<script>
  const trashcan = document.querySelector('button.delete');

  if (trashcan) {
    trashcan.addEventListener('click', () => {
      const ok = confirm('Are you sure you want to delete this blog?');
      if (!ok) return;

      const endpoint = `/blogs/${trashcan.dataset.doc}`;

      fetch(endpoint, {
        method: 'DELETE'
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.redirect) {
            window.location.href = data.redirect;
          }
        })
        .catch(err => console.log(err));
    });
  }
</script>
</body>
</html>
